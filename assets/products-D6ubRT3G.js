import{y as z,j as d,$ as K,r as L,c as H,o as T,a as l,w as o,R as J,S as B,E as C,g as W,_ as Y,J as k,v as G,C as O,U as Q,Y as X,a0 as Z,H as b,I as ee,a1 as y,D as ae,a2 as le,a3 as te,f as r,T as re,W as oe,K as $,a4 as se,a6 as ne,a7 as ie,a8 as ue,a9 as de,F as me}from"./index-BUE9pJ4F.js";import{u as pe,c as ce,a as ve,b as h,e as P,d as m}from"./index.esm-CkR8DL4I.js";import{p as _}from"./product-BKLBj3KS.js";import{b as R}from"./route-block-B_A1xBdJ.js";const ge={class:"px-4"},fe={class:"px-4"},Ve={__name:"products",setup(ke){const u=z(),A=d([]),x=d(""),E=[{title:"ID",key:"_id"},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"價格",key:"price"},{title:"庫存",key:"stock"},{title:"描述",key:"description"},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:t=>new Date(t.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:t=>new Date(t.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],q=["_id","name","category","price","description","createdAt","updatedAt","stock"],F=async()=>{try{const{data:t}=await _.getAll();A.value=t.products}catch(t){console.error("Error fetching products:",t),u({text:"無法載入商品資料",snackbarProps:{color:"red"}})}};F();const S=K("fileAgent"),n=d({open:!1,id:""}),D=t=>{t&&(n.value.id=t._id,p.value.value=t.name,c.value.value=t.price,v.value.value=t.stock,g.value.value=t.description,f.value.value=t.sell),n.value.open=!0},M=()=>{n.value.open=!1,n.value.id="",N(),S.value.deleteFileRecord()},{handleSubmit:I,resetForm:N,isSubmitting:w}=pe({validationSchema:ce({name:h().required("商品名稱是必填的").max(100,"商品名稱最多只能有 100 個字元"),price:P().typeError("價格是必填的").required("價格是必填的").min(0,"價格不能為負數"),stock:P().typeError("庫存是必填的").required("庫存是必填的").min(0,"庫存不能為負數"),description:h().max(500,"描述最多只能有 500 個字元"),sell:ve().required("是否上架是必填的")}),initialValues:{name:"",price:0,description:"",sell:!1}}),p=m("name"),c=m("price"),v=m("stock"),g=m("description"),f=m("sell"),i=d([]),U=d([]),j=I(async t=>{var e,V,a;if((e=i.value[0])!=null&&e.error){u({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}if(n.value.id.length===0&&i.value.length===0){u({text:"請上傳商品圖片",snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("name",t.name),s.append("price",t.price),s.append("stock",t.stock),s.append("description",t.description),s.append("sell",t.sell),i.value.length>0&&s.append("image",i.value[0].file),await(n.value.id.length===0?_.create(s):_.update(n.value.id,s)),u({text:"操作成功！",snackbarProps:{color:"green"}}),M(),F()}catch(s){console.error(s),u({text:((a=(V=s==null?void 0:s.response)==null?void 0:V.data)==null?void 0:a.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}});return(t,e)=>{const V=L("VueFileAgent");return T(),H(me,null,[l(ae,null,{default:o(()=>[l(J,null,{default:o(()=>[l(B,{cols:"12"},{default:o(()=>e[10]||(e[10]=[C("h1",{class:"text-h4 text-center"},"商品管理",-1)])),_:1,__:[10]}),l(W),l(B,{cols:"12"},{default:o(()=>[l(Y,{"filter-keys":q,headers:E,items:A.value,search:x.value},{top:o(()=>[l(Z,null,{default:o(()=>[C("div",ge,[l(k,{variant:"outlined",onClick:e[0]||(e[0]=a=>D(null))},{default:o(()=>e[11]||(e[11]=[b("新增商品",-1)])),_:1,__:[11]})]),l(ee),C("div",fe,[l(y,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":o(({value:a})=>[l(X,{src:a,width:"75"},null,8,["src"])]),"item.sell":o(({value:a})=>[a?(T(),G(Q,{key:0,icon:"mdi-check"})):O("",!0)]),"item.action":o(({item:a})=>[l(k,{icon:"mdi-pencil",variant:"text",onClick:s=>D(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),l(de,{modelValue:n.value.open,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.open=a),persistent:"",width:"600"},{default:o(()=>[l(le,{disabled:r(w),onSubmit:te(r(j),["prevent"])},{default:o(()=>[l(re,null,{default:o(()=>[l(oe,null,{default:o(()=>[b($(n.value.id.length>0?"編輯商品":"新增商品"),1)]),_:1}),l(se,null,{default:o(()=>[l(y,{modelValue:r(p).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r(p).value.value=a),"error-messages":r(p).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),l(y,{modelValue:r(c).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>r(c).value.value=a),modelModifiers:{number:!0},"error-messages":r(c).errorMessage.value,label:"價格",min:"0",type:"number"},null,8,["modelValue","error-messages"]),l(y,{modelValue:r(v).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r(v).value.value=a),modelModifiers:{number:!0},"error-messages":r(v).errorMessage.value,label:"庫存",min:"0",type:"number"},null,8,["modelValue","error-messages"]),l(ne,{modelValue:r(g).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>r(g).value.value=a),"error-messages":r(g).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),l(V,{ref_key:"fileAgent",ref:S,modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),"raw-model-value":U.value,"onUpdate:rawModelValue":e[7]||(e[7]=a=>U.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖拽檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),l(ie,{modelValue:r(f).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>r(f).value.value=a),"error-messages":r(f).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),l(ue,null,{default:o(()=>[l(k,{color:"red",disabled:r(w),onClick:M},{default:o(()=>e[12]||(e[12]=[b("取消",-1)])),_:1,__:[12]},8,["disabled"]),l(k,{color:"green",loading:r(w),type:"submit"},{default:o(()=>[b($(n.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof R=="function"&&R(Ve);export{Ve as default};
