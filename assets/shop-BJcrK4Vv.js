import{g as I,S as q}from"./ScrollTrigger-CUwdeFQJ.js";import{x as O,u as D,q as V,o as l,w as a,a as t,z,Z as K,a8 as Q,E as f,H as c,a1 as W,M as S,g as N,a5 as Z,A as J,G as R,a0 as X,Q as Y,j as i,v as ee,k as w,m as te,c as _,f as ae,O as T,P as p,av as re,aw as $,F as x,h as A,_ as oe,ax as se,d as le,e as ne,an as ce,ay as M,az as ie,aA as ue,B as de,K as me}from"./index-D5ZAoQpQ.js";import{H as pe}from"./HeroSection-C9gzyAjA.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{p as fe}from"./product-Cm0oVEzf.js";import{b as U}from"./route-block-B_A1xBdJ.js";const ge=""+new URL("dog-face-BvL0_U8h.jpg",import.meta.url).href,ve={class:"text-subtitle-1 font-weight-medium text-medium-emphasis"},ye={class:"text-h6 font-weight-bold text-primary my-2"},he={class:"text-body-2 product-description"},_e={__name:"ProductCard",props:["_id","image","name","category","price","description"],emits:["add-to-cart"],setup(n,{emit:k}){const u=n,C=k,g=O(),v=D(),d=()=>{C("add-to-cart")},s=()=>{v.isLogin?g.push(`/product/${u._id}`):g.push("/auth")};return(B,E)=>(l(),V(Y,{class:"d-flex flex-column product-card",height:"100%",hover:"",name:"",onClick:s},{default:a(()=>[t(z,{class:"text-white align-end",cover:"",height:"550",src:n.image},{default:a(()=>[t(K,{color:"rgba(0, 0, 0, 0.4)",theme:"dark"},{default:a(()=>[t(Q,{class:"text-body-1 font-weight-bold"},{default:a(()=>[f(c(n.name),1)]),_:1})]),_:1})]),_:1},8,["src"]),t(W,{class:"pt-4 flex-grow-1"},{default:a(()=>[S("div",ve,c(n.category),1),S("div",ye," NT$ "+c(n.price.toLocaleString()),1),S("div",he,c(n.description),1)]),_:1}),t(N),t(Z,{class:"pa-3"},{default:a(()=>[t(J),t(R,{color:"primary","prepend-icon":"mdi-cart-plus",text:"加入購物車",variant:"tonal",onClick:X(d,["prevent"])})]),_:1})]),_:1}))}},xe=F(_e,[["__scopeId","data-v-3e7995ac"]]),L=9,G={__name:"shop",setup(n){const k=i(null),u=ee(),C=D(),g=O(),v=i([]),d=w(()=>v.value.filter(o=>{const r=o.name.toLowerCase().includes(b.value.toLowerCase()),e=y.value?o.category===y.value:!0;return r&&e}).sort((o,r)=>{const e=P[h.value];return e.key==="createdAt"||e.key==="updatedAt"?e.direction*(new Date(o[e.key])-new Date(r[e.key])):e.direction*(o[e.key]>r[e.key]?1:-1)})),s=i(1),B=w(()=>Math.ceil(d.value.length/L)),E=w(()=>d.value.slice((s.value-1)*L,s.value*L)),b=i(""),y=i(""),H=["貓用","狗用"],h=i(0),P=[{text:"名稱",key:"name",direction:1},{text:"價格：低到高",key:"price",direction:1},{text:"價格：高到低",key:"price",direction:-1},{text:"最新商品",key:"createdAt",direction:-1},{text:"最舊商品",key:"createdAt",direction:1}];(async()=>{try{const{data:o}=await fe.get();v.value=o.products}catch(o){console.error("Error fetching products:",o),u({text:"無法載入商品資料",snackbarProps:{color:"red"}})}})();const j=async o=>{var r,e;if(!C.isLogin){g.push("/auth");return}try{await me.cart({product:o,quantity:1}),u({text:"已加入購物車",snackbarProps:{color:"success"}})}catch(m){u({text:((e=(r=m.response)==null?void 0:r.data)==null?void 0:e.message)||"加入購物車失敗",snackbarProps:{color:"red"}})}};return I.registerPlugin(q),te(()=>{const o=k.value;I.fromTo(o,{scale:1,y:0},{scale:.5,y:-200,transformOrigin:"top center",scrollTrigger:{trigger:o,start:"top top",end:"bottom top",scrub:!0,pin:!0,pinSpacing:!1}})}),(o,r)=>(l(),_(x,null,[t(pe,{"image-src":ae(ge),subtitle:"您的每一次消費，都在為毛孩們累積幸福",title:"公益商城"},null,8,["image-src"]),t(de,null,{default:a(()=>[t(T,{align:"center",class:"mb-4"},{default:a(()=>[t(p,{cols:"12",md:"8"},{default:a(()=>[t(re,{modelValue:y.value,"onUpdate:modelValue":[r[0]||(r[0]=e=>y.value=e),r[1]||(r[1]=e=>s.value=1)],mandatory:"","selected-class":"text-primary"},{default:a(()=>[t($,{filter:"",value:"",variant:"outlined"},{default:a(()=>r[5]||(r[5]=[f(" 全部 ",-1)])),_:1,__:[5]}),(l(),_(x,null,A(H,e=>t($,{key:e,filter:"",value:e,variant:"outlined"},{default:a(()=>[f(c(e),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{class:"d-flex align-center",cols:"12",md:"4"},{default:a(()=>[t(oe,{modelValue:b.value,"onUpdate:modelValue":[r[2]||(r[2]=e=>b.value=e),r[3]||(r[3]=e=>s.value=1)],class:"mr-2",clearable:"",density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"solo-filled"},null,8,["modelValue"]),t(se,null,{activator:a(({props:e})=>[t(R,M(e,{icon:"mdi-sort",ripple:!1,variant:"text"}),null,16),f(" "+c(P[h.value].text),1)]),default:a(()=>[t(le,null,{default:a(()=>[(l(),_(x,null,A(P,(e,m)=>t(ne,{key:e.text,active:h.value===m,onClick:ke=>{h.value=m,s.value=1}},{default:a(()=>[t(ce,null,{default:a(()=>[f(c(e.text),1)]),_:2},1024)]),_:2},1032,["active","onClick"])),64))]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"mb-8"}),d.value.length>0?(l(),V(T,{key:0},{default:a(()=>[(l(!0),_(x,null,A(E.value,e=>(l(),V(p,{key:e._id,cols:"12",lg:"4",md:"6"},{default:a(()=>[t(xe,M({ref_for:!0},e,{onAddToCart:m=>j(e._id)}),null,16,["onAddToCart"])]),_:2},1024))),128)),t(p,{cols:"12"},{default:a(()=>[t(ie,{modelValue:s.value,"onUpdate:modelValue":r[4]||(r[4]=e=>s.value=e),circle:"",length:B.value,"total-visible":5},null,8,["modelValue","length"])]),_:1})]),_:1})):(l(),V(T,{key:1},{default:a(()=>[t(p,{cols:"12"},{default:a(()=>[t(ue,{headline:"噢！找不到商品",icon:"mdi-magnify-remove-outline",text:"試試看更換篩選條件或關鍵字吧！",title:"無符合條件的商品"})]),_:1})]),_:1}))]),_:1})],64))}};typeof U=="function"&&U(G);const Ae=F(G,[["__scopeId","data-v-c85b0f3f"]]);export{Ae as default};
