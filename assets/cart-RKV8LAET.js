import{y as P,u as U,A as j,j as k,m as z,k as V,r as D,v as d,o as n,w as s,E as l,a as e,c as v,ap as A,H as u,U as R,J as y,R as E,S as h,T as C,d as F,F as w,h as H,C as S,e as J,aq as K,ar as M,K as i,as as Y,at as G,au as O,I as Q,Y as W,g as I,D as X,P as L}from"./index-CLCoYM-R.js";import{o as Z}from"./order-_Cq6F--z.js";import{b as N}from"./route-block-B_A1xBdJ.js";const tt={key:0,class:"text-center pa-16 pt-10"},et={class:"text-body-1 font-weight-medium"},at={class:"d-flex align-center mt-4"},ot={class:"d-flex justify-space-between mb-2 text-medium-emphasis"},st={class:"d-flex justify-space-between font-weight-bold text-h6 my-4"},lt={__name:"cart",setup(rt){const c=P(),g=U(),T=j(),r=k([]),b=k(!0);z(async()=>{try{const{data:a}=await L.getCart();r.value=a.result}catch(a){console.error(a),c({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}});const x=async(a,t,p)=>{try{const{data:o}=await L.cart({product:t.product._id,quantity:a-t.quantity});t.quantity=a,a<=0&&r.value.splice(p,1),g.cartTotal=o.result}catch(o){console.error(o),c({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},q=(a,t)=>{x(0,a,t)},_=V(()=>r.value.reduce((a,t)=>a+t.product.price*t.quantity,0)),$=V(()=>r.value.length===0||r.value.some(a=>!a.product.sell)),B=async()=>{try{await Z.create(),g.cartTotal=0,T.push("/orders")}catch(a){console.error(a),c({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(a,t)=>{const p=D("router-link");return n(),d(X,{class:"custom-container",fluid:"",style:{"margin-top":"50px","margin-bottom":"50px"}},{default:s(()=>[t[12]||(t[12]=l("h1",{class:"text-h4 font-weight-bold my-4"},"我的購物車",-1)),e(A,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o),border:"start",class:"mb-8",closable:"","close-label":"關閉公告",color:"info",title:"本月合作單位:趙媽媽狗園（社團法人高雄市愛護流浪狗協會)",variant:"tonal"},{default:s(()=>t[1]||(t[1]=[u(" 全館0元即可 ",-1),l("strong",null,"免運費",-1),u(" ！快去挑選更多商品吧！ ",-1)])),_:1,__:[1]},8,["modelValue"]),r.value.length===0?(n(),v("div",tt,[e(R,{color:"grey-lighten-1",size:"80"},{default:s(()=>t[2]||(t[2]=[u("mdi-cart-off",-1)])),_:1,__:[2]}),t[4]||(t[4]=l("h2",{class:"text-h5 my-4"},"您的購物車是空的",-1)),t[5]||(t[5]=l("p",{class:"text-medium-emphasis mb-6"},"快去尋找您喜歡的商品吧！",-1)),e(y,{color:"tea",to:"/shop"},{default:s(()=>t[3]||(t[3]=[u("繼續購物",-1)])),_:1,__:[3]})])):(n(),d(E,{key:1},{default:s(()=>[e(h,{cols:"12",md:"8"},{default:s(()=>[e(C,{variant:"outlined"},{default:s(()=>[e(F,{lines:"three"},{default:s(()=>[(n(!0),v(w,null,H(r.value,(o,m)=>(n(),v(w,{key:o._id},[e(J,{class:K(["py-4",{"bg-red-lighten-5":!o.product.sell}])},{prepend:s(()=>[e(W,{class:"rounded-lg mr-4 cursor-pointer",cover:"",height:"100",src:o.product.image,width:"100",onClick:f=>a.$router.push("/product/"+o.product._id)},null,8,["src","onClick"])]),default:s(()=>[e(M,{class:"font-weight-bold mb-1"},{default:s(()=>[e(p,{class:"text-secondary text-decoration-none",to:"/product/"+o.product._id},{default:s(()=>[u(i(o.product.name),1)]),_:2},1032,["to"])]),_:2},1024),e(Y,{class:"d-flex align-center ga-4"},{default:s(()=>[l("div",et," NT$ "+i(o.product.price.toLocaleString()),1),o.product.sell?S("",!0):(n(),d(G,{key:0,color:"red",label:"",size:"small"},{default:s(()=>t[6]||(t[6]=[u("已下架",-1)])),_:1,__:[6]}))]),_:2},1024),l("div",at,[e(O,{"control-variant":"split",density:"compact","hide-details":"",min:1,"model-value":o.quantity,style:{"max-width":"150px"},variant:"outlined","onUpdate:modelValue":f=>x(f,o,m)},null,8,["model-value","onUpdate:modelValue"]),e(Q),e(y,{color:"grey",icon:"mdi-delete-outline",variant:"text",onClick:f=>q(o,m)},null,8,["onClick"])])]),_:2},1032,["class"]),m<r.value.length-1?(n(),d(I,{key:0})):S("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),e(h,{cols:"12",md:"4"},{default:s(()=>[e(C,{class:"pa-4",style:{position:"sticky",top:"88px"},variant:"outlined"},{default:s(()=>[t[10]||(t[10]=l("h2",{class:"text-h6 font-weight-bold mb-4"},"訂單摘要",-1)),l("div",ot,[t[7]||(t[7]=l("span",null,"小計",-1)),l("span",null,"NT$ "+i(_.value.toLocaleString()),1)]),t[11]||(t[11]=l("div",{class:"d-flex justify-space-between mb-4 text-medium-emphasis"},[l("span",null,"運費"),l("span",null,"免費")],-1)),e(I,{class:"my-2"}),l("div",st,[t[8]||(t[8]=l("span",null,"總計",-1)),l("span",null,"NT$ "+i(_.value.toLocaleString()),1)]),e(y,{block:"",color:"tea",disabled:$.value,size:"large",onClick:B},{default:s(()=>t[9]||(t[9]=[u(" 前往結帳 ",-1)])),_:1,__:[9]},8,["disabled"])]),_:1,__:[10,11]})]),_:1})]),_:1}))]),_:1,__:[12]})}}};typeof N=="function"&&N(lt);export{lt as default};
