import{v as j,u as z,y as U,j as k,m as A,k as V,r as D,q as u,o as n,w as s,C as l,a as e,c as v,ao as R,E as d,S as E,H as y,P as F,Q as h,R as C,d as G,F as w,h as H,A as S,e as M,Y as Q,ap as W,I as i,aq as Y,ar as J,as as K,G as O,W as X,g as I,B as Z,N}from"./index-CR_kg9bL.js";import{o as tt}from"./order-Cn0CNOMu.js";import{b as L}from"./route-block-B_A1xBdJ.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ot={key:0,class:"text-center pa-16 pt-10"},at={class:"text-body-1 font-weight-medium"},st={class:"d-flex align-center mt-4"},lt={class:"d-flex justify-space-between mb-2 text-medium-emphasis"},rt={class:"d-flex justify-space-between font-weight-bold text-h6 my-4"},q={__name:"cart",setup(nt){const c=j(),g=z(),T=U(),r=k([]),_=k(!0);A(async()=>{try{const{data:o}=await N.getCart();r.value=o.result}catch(o){console.error(o),c({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}});const b=async(o,t,p)=>{try{const{data:a}=await N.cart({product:t.product._id,quantity:o-t.quantity});t.quantity=o,o<=0&&r.value.splice(p,1),g.cartTotal=a.result}catch(a){console.error(a),c({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},B=(o,t)=>{b(0,o,t)},x=V(()=>r.value.reduce((o,t)=>o+t.product.price*t.quantity,0)),$=V(()=>r.value.length===0||r.value.some(o=>!o.product.sell)),P=async()=>{try{await tt.create(),g.cartTotal=0,T.push("/orders")}catch(o){console.error(o),c({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(o,t)=>{const p=D("router-link");return n(),u(Z,{class:"custom-container",fluid:"",style:{"margin-top":"50px","margin-bottom":"50px"}},{default:s(()=>[t[12]||(t[12]=l("h1",{class:"text-h4 font-weight-bold my-4"},"我的購物車",-1)),e(R,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),border:"start",class:"mb-8",closable:"","close-label":"關閉公告",color:"info",title:"本月合作單位:趙媽媽狗園（社團法人高雄市愛護流浪狗協會)",variant:"tonal"},{default:s(()=>t[1]||(t[1]=[d(" 全館0元即可 ",-1),l("strong",null,"免運費",-1),d(" ！快去挑選更多商品吧！ ",-1)])),_:1,__:[1]},8,["modelValue"]),r.value.length===0?(n(),v("div",ot,[e(E,{color:"grey-lighten-1",size:"80"},{default:s(()=>t[2]||(t[2]=[d("mdi-cart-off",-1)])),_:1,__:[2]}),t[4]||(t[4]=l("h2",{class:"text-h5 my-4"},"您的購物車是空的",-1)),t[5]||(t[5]=l("p",{class:"text-medium-emphasis mb-6"},"快去尋找您喜歡的商品吧！",-1)),e(y,{color:"tea",to:"/shop"},{default:s(()=>t[3]||(t[3]=[d("繼續購物",-1)])),_:1,__:[3]})])):(n(),u(F,{key:1},{default:s(()=>[e(h,{cols:"12",md:"8"},{default:s(()=>[e(C,{variant:"outlined"},{default:s(()=>[e(G,{lines:"three"},{default:s(()=>[(n(!0),v(w,null,H(r.value,(a,m)=>(n(),v(w,{key:a._id},[e(M,{class:Q(["py-4",{"bg-red-lighten-5":!a.product.sell}])},{prepend:s(()=>[e(X,{class:"rounded-lg mr-4 cursor-pointer",cover:"",height:"100",src:a.product.image,width:"100",onClick:f=>o.$router.push("/product/"+a.product._id)},null,8,["src","onClick"])]),default:s(()=>[e(W,{class:"font-weight-bold mb-1"},{default:s(()=>[e(p,{class:"text-secondary text-decoration-none",to:"/product/"+a.product._id},{default:s(()=>[d(i(a.product.name),1)]),_:2},1032,["to"])]),_:2},1024),e(Y,{class:"d-flex align-center ga-4"},{default:s(()=>[l("div",at," NT$ "+i(a.product.price.toLocaleString()),1),a.product.sell?S("",!0):(n(),u(J,{key:0,color:"red",label:"",size:"small"},{default:s(()=>t[6]||(t[6]=[d("已下架",-1)])),_:1,__:[6]}))]),_:2},1024),l("div",st,[e(K,{"control-variant":"split",density:"compact","hide-details":"",min:1,"model-value":a.quantity,style:{"max-width":"150px"},variant:"outlined","onUpdate:modelValue":f=>b(f,a,m)},null,8,["model-value","onUpdate:modelValue"]),e(O),e(y,{color:"grey",icon:"mdi-delete-outline",variant:"text",onClick:f=>B(a,m)},null,8,["onClick"])])]),_:2},1032,["class"]),m<r.value.length-1?(n(),u(I,{key:0})):S("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),e(h,{cols:"12",md:"4"},{default:s(()=>[e(C,{class:"pa-4",style:{position:"sticky",top:"88px"},variant:"outlined"},{default:s(()=>[t[10]||(t[10]=l("h2",{class:"text-h6 font-weight-bold mb-4"},"訂單摘要",-1)),l("div",lt,[t[7]||(t[7]=l("span",null,"小計",-1)),l("span",null,"NT$ "+i(x.value.toLocaleString()),1)]),t[11]||(t[11]=l("div",{class:"d-flex justify-space-between mb-4 text-medium-emphasis"},[l("span",null,"運費"),l("span",null,"免費")],-1)),e(I,{class:"my-2"}),l("div",rt,[t[8]||(t[8]=l("span",null,"總計",-1)),l("span",null,"NT$ "+i(x.value.toLocaleString()),1)]),e(y,{block:"",color:"tea",disabled:$.value,size:"large",onClick:P},{default:s(()=>t[9]||(t[9]=[d(" 前往結帳 ",-1)])),_:1,__:[9]},8,["disabled"])]),_:1,__:[10,11]})]),_:1})]),_:1}))]),_:1,__:[12]})}}};typeof L=="function"&&L(q);const mt=et(q,[["__scopeId","data-v-6098a382"]]);export{mt as default};
