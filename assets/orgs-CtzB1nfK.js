import{v as Q,j as p,Y as X,r as Y,c as Z,o as N,a as s,w as t,O as J,P as O,M as D,g as W,X as ee,G as A,q as ae,C as le,R as oe,z as se,Z as re,E as U,A as te,_ as d,B as ne,$ as ue,a0 as de,f as l,Q as ie,S as me,H as _,a1 as pe,a2 as ve,a3 as h,a4 as ge,a5 as ce,a6 as Ve,F as fe}from"./index-BseQQyEi.js";import{u as be,c as ye,a as ke,b as v,d as u}from"./index.esm-Dvha9itV.js";import{o as B}from"./org-jp2nmYjq.js";import{b as z}from"./route-block-B_A1xBdJ.js";const xe={class:"px-4"},we={class:"px-4"},Ce={__name:"orgs",setup(Me){const m=Q(),T=p([]),F=p(""),I=[{title:"ID",key:"_id"},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"分類",key:"category"},{title:"地址",key:"address"},{title:"電話",key:"phone"},{title:"描述",key:"description"},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:o=>new Date(o.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:o=>new Date(o.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],j=["_id","name","category","description","createdAt","updatedAt","address","phone"],q=async()=>{try{const{data:o}=await B.getAll();T.value=o.orgs}catch(o){console.error("Error fetching orgs:",o),m({text:"無法載入單位資料",snackbarProps:{color:"red"}})}};q();const H=X("fileAgent"),n=p({open:!1,id:""}),P=o=>{o&&(n.value.id=o._id,g.value.value=o.name,c.value.value=o.category,V.value.value=o.address,x.value.value=o.phone,f.value.value=o.mail,b.value.value=o.fb,y.value.value=o.website,k.value.value=o.openingHours,w.value.value=o.description,C.value.value=o.sell),n.value.open=!0},R=()=>{n.value.open=!1,n.value.id="",G(),H.value.deleteFileRecord()},$=["北部","中部","南部"],{handleSubmit:L,resetForm:G,isSubmitting:S}=be({validationSchema:ye({name:v().required("單位名稱是必填的").max(100,"單位名稱最多只能有 100 個字元"),category:v().required("分類是必填的").oneOf($,"請選擇有效的分類"),address:v().required("地址是必填的").max(100,"地址多只能有 100 個字元"),phone:v().typeError("電話是必填的").required("電話是必填的"),description:v().max(500,"描述最多只能有 500 個字元"),sell:ke().required("是否上架是必填的")}),initialValues:{name:"",category:"",description:"",sell:!1}}),g=u("name"),c=u("category"),V=u("address"),f=u("mail"),b=u("fb"),y=u("website"),k=u("openingHours"),x=u("phone"),w=u("description"),C=u("sell"),i=p([]),E=p([]),K=L(async o=>{var e,M,a;if((e=i.value[0])!=null&&e.error){m({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}if(n.value.id.length===0&&i.value.length===0){m({text:"請上傳單位圖片",snackbarProps:{color:"red"}});return}try{const r=new FormData;r.append("name",o.name),r.append("category",o.category),r.append("address",o.address),r.append("mail",o.mail),r.append("fb",o.fb),r.append("website",o.website),r.append("openingHours",o.openingHours),r.append("addres",o.addres),r.append("phone",o.phone),r.append("description",o.description),r.append("sell",o.sell),i.value.length>0&&r.append("image",i.value[0].file),await(n.value.id.length===0?B.create(r):B.update(n.value.id,r)),m({text:"操作成功！",snackbarProps:{color:"green"}}),R(),q()}catch(r){console.error(r),m({text:((a=(M=r==null?void 0:r.response)==null?void 0:M.data)==null?void 0:a.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}});return(o,e)=>{const M=Y("VueFileAgent");return N(),Z(fe,null,[s(ne,null,{default:t(()=>[s(J,null,{default:t(()=>[s(O,{cols:"12"},{default:t(()=>e[15]||(e[15]=[D("h1",{class:"text-center"},"單位管理",-1)])),_:1,__:[15]}),s(W),s(O,{cols:"12"},{default:t(()=>[s(ee,{"filter-keys":j,headers:I,items:T.value,search:F.value},{top:t(()=>[s(re,null,{default:t(()=>[D("div",xe,[s(A,{variant:"outlined",onClick:e[0]||(e[0]=a=>P(null))},{default:t(()=>e[16]||(e[16]=[U("新增單位",-1)])),_:1,__:[16]})]),s(te),D("div",we,[s(d,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=a=>F.value=a),density:"compact",flat:"","hide-details":"",placeholder:"搜尋單位","prepend-inner-icon":"mdi-magnify",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":t(({value:a})=>[s(se,{src:a,width:"75"},null,8,["src"])]),"item.sell":t(({value:a})=>[a?(N(),ae(oe,{key:0,icon:"mdi-check"})):le("",!0)]),"item.action":t(({item:a})=>[s(A,{icon:"mdi-pencil",variant:"text",onClick:r=>P(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),s(Ve,{modelValue:n.value.open,"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.open=a),persistent:"",width:"600"},{default:t(()=>[s(ue,{disabled:l(S),onSubmit:de(l(K),["prevent"])},{default:t(()=>[s(ie,null,{default:t(()=>[s(me,null,{default:t(()=>[U(_(n.value.id.length>0?"編輯單位":"新增單位"),1)]),_:1}),s(pe,null,{default:t(()=>[s(d,{modelValue:l(g).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>l(g).value.value=a),"error-messages":l(g).errorMessage.value,label:"單位名稱"},null,8,["modelValue","error-messages"]),s(ve,{modelValue:l(c).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>l(c).value.value=a),"error-messages":l(c).errorMessage.value,items:$,label:"分類"},null,8,["modelValue","error-messages"]),s(h,{modelValue:l(V).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>l(V).value.value=a),"error-messages":l(V).errorMessage.value,label:"地址"},null,8,["modelValue","error-messages"]),s(d,{modelValue:l(x).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>l(x).value.value=a),"error-messages":l(x).errorMessage.value,label:"電話"},null,8,["modelValue","error-messages"]),s(d,{modelValue:l(f).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>l(f).value.value=a),"error-messages":l(f).errorMessage.value,label:"電子信箱"},null,8,["modelValue","error-messages"]),s(d,{modelValue:l(b).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>l(b).value.value=a),"error-messages":l(b).errorMessage.value,label:"Facebook網站"},null,8,["modelValue","error-messages"]),s(d,{modelValue:l(y).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>l(y).value.value=a),"error-messages":l(y).errorMessage.value,label:"官方網站"},null,8,["modelValue","error-messages"]),s(d,{modelValue:l(k).value.value,"onUpdate:modelValue":e[9]||(e[9]=a=>l(k).value.value=a),"error-messages":l(k).errorMessage.value,label:"營業狀況"},null,8,["modelValue","error-messages"]),s(h,{modelValue:l(w).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>l(w).value.value=a),"error-messages":l(w).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),s(M,{ref_key:"fileAgent",ref:H,modelValue:i.value,"onUpdate:modelValue":e[11]||(e[11]=a=>i.value=a),"raw-model-value":E.value,"onUpdate:rawModelValue":e[12]||(e[12]=a=>E.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖拽檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),s(ge,{modelValue:l(C).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>l(C).value.value=a),"error-messages":l(C).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),s(ce,null,{default:t(()=>[s(A,{color:"red",disabled:l(S),onClick:R},{default:t(()=>e[17]||(e[17]=[U("取消",-1)])),_:1,__:[17]},8,["disabled"]),s(A,{color:"green",loading:l(S),type:"submit"},{default:t(()=>[U(_(n.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof z=="function"&&z(Ce);export{Ce as default};
