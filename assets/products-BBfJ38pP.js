import{v as j,j as d,Z as K,r as L,c as G,o as U,a as l,w as o,P as H,Q as B,K as C,g as Q,Y,G as k,q as Z,C as J,S as O,z as W,_ as X,E as b,A as ee,$ as y,B as ae,a0 as le,a1 as te,f as r,R as re,T as oe,H as P,a2 as se,a4 as ne,a5 as ie,a6 as ue,a7 as de,F as me}from"./index-C9W7BD91.js";import{u as pe,c as ce,a as ve,b as $,e as R,d as m}from"./index.esm-DSZOjfeY.js";import{p as A}from"./product-D7o0ofJM.js";import{b as h}from"./route-block-B_A1xBdJ.js";const ge={class:"px-4"},fe={class:"px-4"},Ve={__name:"products",setup(ke){const u=j(),_=d([]),x=d(""),q=[{title:"ID",key:"_id"},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"價格",key:"price"},{title:"庫存",key:"stock"},{title:"描述",key:"description"},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:t=>new Date(t.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:t=>new Date(t.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],E=["_id","name","category","price","description","createdAt","updatedAt","stock"],F=async()=>{try{const{data:t}=await A.getAll();_.value=t.products}catch(t){console.error("Error fetching products:",t),u({text:"無法載入商品資料",snackbarProps:{color:"red"}})}};F();const S=K("fileAgent"),n=d({open:!1,id:""}),M=t=>{t&&(n.value.id=t._id,p.value.value=t.name,c.value.value=t.price,v.value.value=t.stock,g.value.value=t.description,f.value.value=t.sell),n.value.open=!0},D=()=>{n.value.open=!1,n.value.id="",z(),S.value.deleteFileRecord()},{handleSubmit:N,resetForm:z,isSubmitting:w}=pe({validationSchema:ce({name:$().required("商品名稱是必填的").max(100,"商品名稱最多只能有 100 個字元"),price:R().typeError("價格是必填的").required("價格是必填的").min(0,"價格不能為負數"),stock:R().typeError("庫存是必填的").required("庫存是必填的").min(0,"庫存不能為負數"),description:$().max(500,"描述最多只能有 500 個字元"),sell:ve().required("是否上架是必填的")}),initialValues:{name:"",price:0,description:"",sell:!1}}),p=m("name"),c=m("price"),v=m("stock"),g=m("description"),f=m("sell"),i=d([]),T=d([]),I=N(async t=>{var e,V,a;if((e=i.value[0])!=null&&e.error){u({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}if(n.value.id.length===0&&i.value.length===0){u({text:"請上傳商品圖片",snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("name",t.name),s.append("price",t.price),s.append("stock",t.stock),s.append("description",t.description),s.append("sell",t.sell),i.value.length>0&&s.append("image",i.value[0].file),await(n.value.id.length===0?A.create(s):A.update(n.value.id,s)),u({text:"操作成功！",snackbarProps:{color:"green"}}),D(),F()}catch(s){console.error(s),u({text:((a=(V=s==null?void 0:s.response)==null?void 0:V.data)==null?void 0:a.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}});return(t,e)=>{const V=L("VueFileAgent");return U(),G(me,null,[l(ae,null,{default:o(()=>[l(H,null,{default:o(()=>[l(B,{cols:"12"},{default:o(()=>e[10]||(e[10]=[C("h1",{class:"text-center"},"商品管理",-1)])),_:1,__:[10]}),l(Q),l(B,{cols:"12"},{default:o(()=>[l(Y,{"filter-keys":E,headers:q,items:_.value,search:x.value},{top:o(()=>[l(X,null,{default:o(()=>[C("div",ge,[l(k,{variant:"outlined",onClick:e[0]||(e[0]=a=>M(null))},{default:o(()=>e[11]||(e[11]=[b("新增商品",-1)])),_:1,__:[11]})]),l(ee),C("div",fe,[l(y,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":o(({value:a})=>[l(W,{src:a,width:"75"},null,8,["src"])]),"item.sell":o(({value:a})=>[a?(U(),Z(O,{key:0,icon:"mdi-check"})):J("",!0)]),"item.action":o(({item:a})=>[l(k,{icon:"mdi-pencil",variant:"text",onClick:s=>M(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),l(de,{modelValue:n.value.open,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.open=a),persistent:"",width:"600"},{default:o(()=>[l(le,{disabled:r(w),onSubmit:te(r(I),["prevent"])},{default:o(()=>[l(re,null,{default:o(()=>[l(oe,null,{default:o(()=>[b(P(n.value.id.length>0?"編輯商品":"新增商品"),1)]),_:1}),l(se,null,{default:o(()=>[l(y,{modelValue:r(p).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r(p).value.value=a),"error-messages":r(p).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),l(y,{modelValue:r(c).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>r(c).value.value=a),modelModifiers:{number:!0},"error-messages":r(c).errorMessage.value,label:"價格",min:"0",type:"number"},null,8,["modelValue","error-messages"]),l(y,{modelValue:r(v).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r(v).value.value=a),modelModifiers:{number:!0},"error-messages":r(v).errorMessage.value,label:"庫存",min:"0",type:"number"},null,8,["modelValue","error-messages"]),l(ne,{modelValue:r(g).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>r(g).value.value=a),"error-messages":r(g).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),l(V,{ref_key:"fileAgent",ref:S,modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),"raw-model-value":T.value,"onUpdate:rawModelValue":e[7]||(e[7]=a=>T.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖拽檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),l(ie,{modelValue:r(f).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>r(f).value.value=a),"error-messages":r(f).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),l(ue,null,{default:o(()=>[l(k,{color:"red",disabled:r(w),onClick:D},{default:o(()=>e[12]||(e[12]=[b("取消",-1)])),_:1,__:[12]},8,["disabled"]),l(k,{color:"green",loading:r(w),type:"submit"},{default:o(()=>[b(P(n.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof h=="function"&&h(Ve);export{Ve as default};
