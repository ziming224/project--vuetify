import{v as A,u as O,at as q,j as c,l as G,m as Q,c as g,o as r,a,C as p,q as n,w as t,au as W,s as J,F as w,h as C,Q as H,av as K,P as L,E as i,S,H as b,R as T,W as F,U as I,I as f,T as B,a6 as N,a1 as X,G as P,A as u,a2 as Y,d as Z,g as $,aw as z,e as m,ap as ee,a7 as ae,N as D}from"./index-X5qswVBp.js";import{b as M}from"./route-block-B_A1xBdJ.js";const te={key:1,class:"text-center pa-8"},le={class:"text-body-1",style:{"white-space":"pre-line"}},se=["innerHTML"],re={__name:"favorites",setup(oe){const _=A(),U=O(),{isLoggedIn:E}=q(U),v=c([]),x=c([]),V=c(!0),y=c(!1),k=c(!1),l=c(null),R=o=>{l.value=o,k.value=!0},h=async()=>{try{const{data:o}=await D.getFavorites();v.value=o.result.map(e=>({_id:e._id,title:e.name,short:e.description.slice(0,40)+"...",detail:e.description,short:e.description?e.description.slice(0,40)+"...":"",detail:e.description||"",image:e.image,category:e.category,address:e.address,phone:e.phone,mail:e.mail,fb:e.fb,website:e.website,openingHours:e.openingHours})),x.value=o.result.map(e=>e._id)}catch(o){console.error("Error fetching favorites:",o),_({text:"無法載入收藏列表",snackbarProps:{color:"red"}})}finally{V.value=!1}},j=async o=>{var e,s;y.value=!0;try{await D.addFavorite({org:o._id}),await h(),_({text:"已取消收藏",snackbarProps:{color:"success",timeout:2e3}})}catch(d){console.error("收藏操作失敗:",d),_({text:((s=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:s.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red",timeout:2e3}})}finally{y.value=!1}};return G(E,o=>{o?h():(v.value=[],x.value=[])}),Q(h),(o,e)=>(r(),g("div",null,[a(J,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),class:"align-center justify-center",persistent:""},{default:t(()=>[a(W,{indeterminate:"",color:"primary",size:"64"})]),_:1},8,["modelValue"]),e[11]||(e[11]=p("h2",{class:"text-h5 font-weight-bold mb-6"},"我的收藏",-1)),V.value?(r(),n(L,{key:0},{default:t(()=>[(r(),g(w,null,C(3,s=>a(H,{key:s,cols:"12",md:"4"},{default:t(()=>[a(K,{type:"card"})]),_:2},1024)),64))]),_:1})):v.value.length===0?(r(),g("div",te,[a(S,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[3]||(e[3]=[i("mdi-heart-off-outline",-1)])),_:1,__:[3]}),e[5]||(e[5]=p("h3",{class:"text-h6 my-4"},"您尚未收藏任何單位",-1)),e[6]||(e[6]=p("p",{class:"text-medium-emphasis mb-6"},"在單位頁面點擊愛心即可加入收藏！",-1)),a(b,{color:"primary",to:"/org"},{default:t(()=>e[4]||(e[4]=[i("前往救援單位",-1)])),_:1,__:[4]})])):(r(),n(L,{key:2},{default:t(()=>[(r(!0),g(w,null,C(v.value,s=>(r(),n(H,{key:s._id,cols:"12",sm:"6",md:"4"},{default:t(()=>[a(T,{onClick:d=>R(s),hover:"",border:""},{default:t(()=>[a(F,{src:s.image,height:"200px",cover:"",class:"align-end text-white"},null,8,["src"]),a(I,{class:"pt-4"},{default:t(()=>[i(f(s.category),1)]),_:2},1024),a(B,{class:"pt-0 text-h6 font-weight-bold",style:{"white-space":"normal","word-break":"break-word"}},{default:t(()=>[i(f(s.title),1)]),_:2},1024),a(N,null,{default:t(()=>[a(b,{icon:"mdi-heart",color:"red",size:"small",variant:"text",onClick:X(d=>j(s),["stop"])},null,8,["onClick"]),a(P),a(b,{color:"secondary",variant:"text"},{default:t(()=>e[7]||(e[7]=[i("查看詳情",-1)])),_:1,__:[7]})]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),a(ae,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),"max-width":"600px",scrollable:""},{default:t(()=>[l.value?(r(),n(T,{key:0,class:"org-dialog-card"},{default:t(()=>[a(F,{class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"250px",src:l.value.image},{default:t(()=>[a(B,{class:"text-white text-h5",style:{"text-shadow":"1px 1px 3px rgba(0,0,0,0.7)"}},{default:t(()=>[i(f(l.value.title),1)]),_:1})]),_:1},8,["src"]),a(I,{class:"pt-4"},{default:t(()=>[a(S,{class:"mr-1",icon:"mdi-map-marker",size:"small"}),i(" "+f(l.value.address),1)]),_:1}),a(Y,{class:"pt-2 pb-0"},{default:t(()=>[p("p",le,f(l.value.detail),1)]),_:1}),a(Z,{class:"py-0",density:"compact"},{default:t(()=>[a($,{class:"mx-4 my-2"}),a(z,null,{default:t(()=>e[8]||(e[8]=[i("聯絡資訊",-1)])),_:1,__:[8]}),l.value.phone?(r(),n(m,{key:0,class:"link-item",href:`tel:${l.value.phone}`,"prepend-icon":"mdi-phone",rel:"noopener noreferrer",target:"_blank",title:l.value.phone},null,8,["href","title"])):u("",!0),l.value.fb?(r(),n(m,{key:1,class:"link-item",href:l.value.fb,"prepend-icon":"mdi-facebook",rel:"noopener noreferrer",target:"_blank",title:"Facebook 粉專"},null,8,["href"])):u("",!0),l.value.website?(r(),n(m,{key:2,class:"link-item",href:l.value.website,"prepend-icon":"mdi-web",rel:"noopener noreferrer",target:"_blank",title:"官方網站"},null,8,["href"])):u("",!0),l.value.mail?(r(),n(m,{key:3,class:"link-item",href:`mailto:${l.value.mail}`,"prepend-icon":"mdi-email",rel:"noopener noreferrer",target:"_blank",title:l.value.mail},null,8,["href","title"])):u("",!0),l.value.openingHours?(r(),n($,{key:4,class:"mx-4 my-2"})):u("",!0),l.value.openingHours?(r(),n(z,{key:5},{default:t(()=>e[9]||(e[9]=[i(" 營運時間 ",-1)])),_:1,__:[9]})):u("",!0),l.value.openingHours?(r(),n(m,{key:6,"prepend-icon":"mdi-clock-outline"},{default:t(()=>[a(ee,{style:{"white-space":"pre-line","line-height":"1.6"}},{default:t(()=>[p("span",{innerHTML:!l.value.openingHours||l.value.openingHours==="undefined"?"尚未提供":l.value.openingHours.replace(/\n/g,"<br>")},null,8,se)]),_:1})]),_:1})):u("",!0)]),_:1}),a(N,null,{default:t(()=>[a(P),a(b,{color:"secondary",variant:"text",onClick:e[1]||(e[1]=s=>k.value=!1)},{default:t(()=>e[10]||(e[10]=[i("關閉",-1)])),_:1,__:[10]})]),_:1})]),_:1})):u("",!0)]),_:1},8,["modelValue"])]))}};typeof M=="function"&&M(re);export{re as default};
