import{v as S,u as I,x as L,j as N,k as v,r as P,q as k,o as l,w as t,a as e,P as T,Q as u,K as m,g as y,d as D,c as V,F as C,h as U,C as E,e as F,ao as R,E as d,H as i,ap as $,aq as j,W as z,z as A,G,B as H,M as h}from"./index-C9W7BD91.js";import{o as K}from"./order-DdAxZ3x9.js";import{b as x}from"./route-block-B_A1xBdJ.js";const M={__name:"cart",setup(Q){const c=S(),p=I(),b=L(),s=N([]);(async()=>{try{const{data:a}=await h.getCart();s.value=a.result}catch(a){console.error(a),c({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}})();const g=async(a,o,n)=>{try{const{data:r}=await h.cart({product:o.product._id,quantity:a-o.quantity});o.quantity=a,a<=0&&s.value.splice(n,1),p.cartTotal=r.result}catch(r){console.error(r),c({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},q=v(()=>s.value.reduce((a,o)=>a+o.product.price*o.quantity,0)),w=v(()=>s.value.length===0||s.value.some(a=>!a.product.sell)),B=async()=>{try{await K.create(),p.cartTotal=0,b.push("/orders")}catch{console.error(error),c({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(a,o)=>{const n=P("router-link");return l(),k(H,null,{default:t(()=>[e(T,null,{default:t(()=>[e(u,{cols:"12"},{default:t(()=>o[0]||(o[0]=[m("h1",{class:"text-center"},"購物車",-1)])),_:1,__:[0]}),e(y),e(u,{cols:"12"},{default:t(()=>[e(D,{lines:"two"},{default:t(()=>[(l(!0),V(C,null,U(s.value,(r,_)=>(l(),V(C,{key:r._id},[e(F,{active:!r.product.sell,color:"red"},{prepend:t(()=>[e(z,{class:"cursor-pointer",rounded:"0",onClick:f=>a.$router.push("/product/"+r.product._id)},{default:t(()=>[e(A,{src:r.product.image},null,8,["src"])]),_:2},1032,["onClick"])]),append:t(()=>[e(j,{"control-variant":"split","hide-details":"",min:0,"model-value":r.quantity,variant:"outlined",width:"150px","onUpdate:modelValue":f=>g(f,r,_)},null,8,["model-value","onUpdate:modelValue"])]),default:t(()=>[e(R,null,{default:t(()=>[e(n,{class:"text-decoration-none text-white",to:"/product/"+r.product._id},{default:t(()=>[d(i(r.product.name),1)]),_:2},1032,["to"])]),_:2},1024),e($,null,{default:t(()=>[d(" 價格: "+i(r.product.price)+" 元 ",1)]),_:2},1024)]),_:2},1032,["active"]),_<s.value.length-1?(l(),k(y,{key:0})):E("",!0)],64))),128))]),_:1})]),_:1}),e(u,{class:"text-center",cols:"12"},{default:t(()=>[m("p",null,"總金額: "+i(q.value),1),e(G,{color:"primary",disabled:w.value,onClick:B},{default:t(()=>o[1]||(o[1]=[d("結帳",-1)])),_:1,__:[1]},8,["disabled"])]),_:1})]),_:1})]),_:1})}}};typeof x=="function"&&x(M);export{M as default};
